<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
<meta name="robots" content="noindex, nofollow" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ZhehanZ Protection</title>

<style>
  /* 主题与排版(与前保持一致) */
  body{font-family:Arial,sans-serif;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;min-height:100vh;margin:0;padding:20px;background:#fff;color:#333}
  .spinner,.warning{width:40px;height:40px;margin-bottom:20px}
  .spinner{border:4px solid #ddd;border-top:4px solid #333;border-radius:50%;animation:spin 1s linear infinite}
  .warning{border:4px solid #333;border-radius:50%;display:none;position:relative}
  .warning::before{content:"!";color:#333;font-size:24px;font-weight:bold;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
  @keyframes spin{to{transform:rotate(360deg)}}
  .large{font-size:1.8em;font-weight:bold;margin:0}
  .status{font-size:1em;color:#777;margin:8px 0 20px}
  .captcha-container{margin:20px 0}
  .captcha-container form{display:inline-block;text-align:left}
  .protection{font-size:.8em;color:#777;margin-top:20px;margin-bottom:5px}
  .more-info{display:flex;flex-direction:column;align-items:center}
  .more-info a{font-size:.8em;color:#777;text-decoration:underline;cursor:pointer;margin-bottom:5px}
  .info-text{font-size:.8em;color:#777;text-align:center;max-width:55%;overflow:hidden;max-height:0;opacity:0;transition:max-height .3s ease,opacity .3s ease}
  .info-text.open{max-height:200px;opacity:1}
  .visually-hidden{opacity:0;height:1px;width:1px;overflow:hidden;pointer-events:none}
  @media(prefers-color-scheme:dark){body{background:#121212;color:#e0e0e0}.spinner{border:4px solid #444;border-top:4px solid #e0e0e0}.warning{border-color:#e0e0e0}.warning::before{color:#e0e0e0}.status,.protection,.info-text,.more-info a{color:#aaa}}
</style>
<!-- 若站点仍插入 <meta http-equiv="refresh"> 可先保留，JS 会在进入 captcha 模式时移除 -->
</head>

<body>
  <div class="spinner"></div>
  <div class="warning"></div>

  <p class="large"  id="title"></p>
  <p class="status" id="status"></p>

  <div class="captcha-container">
    <form id="captcha-form">::CAPTCHA_BOX::</form>
  </div>

  <p class="protection" id="brand"></p>

  <div class="more-info">
    <a id="toggle"></a>
    <div class="info-text" id="detail"></div>
  </div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  /* ------- 文案 ------- */
  const lang = navigator.language.startsWith('zh')?'zh':'en';
  const TXT = {
    zh:{five:{t:'请稍作等候',s1:'正在检查网络',s2:'检查完成，即将继续访问'},
        cap :{t:'请完成验证',s :'完成以下人机验证以继续访问'},
        brand:'ZhehanZ 由 Cloudflare 防护',
        show:'查看更多信息',hide:'隐藏更多信息',
        detail:['::RAY_ID::','::CLIENT_IP:: ::GEO::','此页面因异常网络活动或强化的安全防护而显示。']},
    en:{five:{t:'A moment please',s1:'Checking your network...',s2:'Check complete. Proceeding...'},
        cap :{t:'Complete verification',s :'Pass the turnstile to continue access'},
        brand:'ZhehanZ protected by Cloudflare',
        show:'Show details',hide:'Hide details',
        detail:['::RAY_ID::','::CLIENT_IP:: ::GEO::','This page appears due to unusual activity or enhanced security measures.']}
  }[lang];

  /* ------- DOM 引用 ------- */
  const spinner=document.querySelector('.spinner');
  const warning=document.querySelector('.warning');
  const title  =document.getElementById('title');
  const status =document.getElementById('status');
  const brand  =document.getElementById('brand');
  const toggle =document.getElementById('toggle');
  const detail =document.getElementById('detail');
  const form   =document.getElementById('captcha-form');
  brand.textContent=TXT.brand;

  /* ------- 详情展开 ------- */
  toggle.textContent=TXT.show;
  toggle.addEventListener('click',()=>{
    const open=detail.classList.toggle('open');
    toggle.textContent=open?TXT.hide:TXT.show;
    if(open) detail.innerHTML=TXT.detail.map(d=>`<p>${d}</p>`).join('');
  });

  /* ------- 状态控制 ------- */
  let timerId=null;
  function startFiveTimer(){
    status.textContent=TXT.five.s1;
    timerId=setTimeout(()=>{status.textContent=TXT.five.s2;},5000);
  }
  function clearFiveTimer(){ if(timerId){clearTimeout(timerId);timerId=null;} }

  /* ------- 模式切换 ------- */
  let mode='init';
  const widgetSel='#turnstile-widget,#turnstile-wrapper,.cf-turnstile';
  function visualHide(){
    const wrapper=form.querySelector(widgetSel)?.closest('div[id]')||null;
    Array.from(form.children).forEach(el=>{
      el.classList.toggle('visually-hidden',el!==wrapper);
    });
  }
  function switchMode(newMode){
    if(mode===newMode) return;
    mode=newMode;
    if(newMode==='captcha'){    // 切换到 Captcha
      clearFiveTimer();
      // 去掉任何 meta refresh
      document.querySelectorAll('meta[http-equiv=\"refresh\"]').forEach(m=>m.parentNode.removeChild(m));

      spinner.style.display='none';
      warning.style.display='block';
      title.textContent=TXT.cap.t;
      status.textContent=TXT.cap.s;
      visualHide();
    }else{                      // 切到 5 秒模式
      spinner.style.display='block';
      warning.style.display='none';
      title.textContent=TXT.five.t;
      startFiveTimer();
    }
  }

  /* ------- 观察 Turnstile 注入 ------- */
  const obs=new MutationObserver(()=>switchMode(form.querySelector(widgetSel)?'captcha':'five'));
  obs.observe(form,{childList:true,subtree:true});

  /* 初始化 */
  switchMode(form.querySelector(widgetSel)?'captcha':'five');
});
</script>
</body>
</html>